<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>ÏïÑÏù¥Ìè∞ Ïä§ÌÉÄÏùº Ï†ÑÌôî ÌÇ§Ìå®Îìú</title>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>
<style>
  body, html {
    margin: 0; padding: 0;
    height: 100%;
    background: #000;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
      Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    display: flex;
    flex-direction: column;
  }

  #phone-number {
    height: 130px;
    font-size: 52px;
    text-align: center;
    letter-spacing: 8px;
    padding-top: 30px;
    user-select: text;
    color: white;
    background: #111;
    border-bottom: 1px solid #222;
    overflow-wrap: break-word;
    margin: 0 10px;
  }

  .keypad {
    flex: 1;
    background: #000;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    padding: 30px 20px 20px 20px;
    margin: 0 10px;
  }

  button.key {
    background: #222;
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 30px;
    user-select: none;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    aspect-ratio: 1 / 1;
    box-shadow: 0 3px 6px rgba(255,255,255,0.15);
    transition: background 0.2s;
  }
  button.key:active {
    background: #555;
  }

  .actions {
    height: 90px;
    background: #000;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 0 30px;
    border-top: 1px solid #222;
    margin: 0 10px 10px 10px;
  }

  .actions button {
    background: none;
    border: none;
    color: white;
    font-size: 36px;
    cursor: pointer;
    user-select: none;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .actions button:disabled {
    color: #444;
    cursor: default;
  }
  .actions button:active:not(:disabled) {
    color: #0f0;
  }

  /* Ï†ÑÌôî Ïò§Îäî Î™®Îã¨ */
  #incoming-call {
    position: fixed;
    top: 0; left: 0; right: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    color: white;
    padding: 20px 0;
    user-select: none;
  }
  #incoming-call.show {
    display: flex;
  }
  #incoming-call .caller-id {
    font-size: 26px;
    margin-bottom: 18px;
    font-weight: 600;
  }
  #incoming-call .call-actions {
    display: flex;
    gap: 24px;
  }
  #incoming-call .call-actions button {
    padding: 16px;
    font-size: 36px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    user-select: none;
    width: 66px;
    height: 66px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #incoming-call .call-actions button.answer {
    background: #4CAF50;
    color: white;
  }
  #incoming-call .call-actions button.reject {
    background: #F44336;
    color: white;
  }

  /* ÌÜµÌôî Ï§ë Ï†ÑÏ≤¥ ÌôîÎ©¥ Î™®Îã¨ */
  #in-call-fullscreen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #111;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 3000;
    user-select: none;
    color: white;
    padding: 20px;
    box-sizing: border-box;
  }
  #in-call-fullscreen.show {
    display: flex;
  }
  #in-call-fullscreen .caller-id {
    font-size: 38px;
    font-weight: 700;
    margin-bottom: 24px;
  }
  #in-call-fullscreen .status-text {
    font-size: 24px;
    margin-bottom: 12px;
  }
  #in-call-fullscreen .call-time {
    font-size: 22px;
    margin-bottom: 60px;
    font-weight: 500;
  }
  #in-call-fullscreen .end-call-btn {
    background: #F44336;
    border: none;
    color: white;
    font-size: 56px;
    border-radius: 50%;
    width: 100px;
    height: 100px;
    cursor: pointer;
    user-select: none;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 20px #f44336aa;
    transition: background 0.2s;
  }
  #in-call-fullscreen .end-call-btn:active {
    background: #d32f2f;
  }
</style>
</head>
<body>

<div id="phone-number"></div>

<div class="keypad">
  <button class="key">1</button>
  <button class="key">2</button>
  <button class="key">3</button>
  <button class="key">4</button>
  <button class="key">5</button>
  <button class="key">6</button>
  <button class="key">7</button>
  <button class="key">8</button>
  <button class="key">9</button>
  <button class="key">*</button>
  <button class="key">0</button>
  <button class="key">#</button>
</div>

<div class="actions">
  <button id="call-btn" disabled title="Ï†ÑÌôîÍ±∏Í∏∞">
    <i class="fas fa-phone"></i>
  </button>
  <button id="answer-btn" style="display:none;" title="Î∞õÍ∏∞">
    <i class="fas fa-phone-volume"></i>
  </button>
  <button id="clear-btn" title="ÏßÄÏö∞Í∏∞">
    <i class="fas fa-backspace"></i>
  </button>
</div>

<!-- Ï†ÑÌôî Ïò§Îäî ÏïåÎ¶º Î™®Îã¨ -->
<div id="incoming-call">
  <div class="caller-id" id="caller-number">010-1234-5678</div>
  <div class="call-actions">
    <button class="answer" id="modal-answer-btn" title="Î∞õÍ∏∞">
      <i class="fas fa-phone-volume"></i>
    </button>
    <button class="reject" id="modal-reject-btn" title="Í±∞Ï†à">
      <i class="fas fa-phone-slash"></i>
    </button>
  </div>
</div>

<!-- ÌÜµÌôî Ï§ë Ï†ÑÏ≤¥ ÌôîÎ©¥ Î™®Îã¨ -->
<div id="in-call-fullscreen">
  <div class="caller-id" id="in-call-number"></div>
  <div class="status-text">ÌÜµÌôî Ï§ë...</div>
  <div class="call-time" id="call-time">0Ï¥à</div>
  <button class="end-call-btn" id="end-call-btn" title="ÌÜµÌôî Ï¢ÖÎ£å">
    <i class="fas fa-phone-slash"></i>
  </button>
</div>

<script>
  const display = document.getElementById('phone-number');
  const keys = document.querySelectorAll('.key');
  const callBtn = document.getElementById('call-btn');
  const clearBtn = document.getElementById('clear-btn');
  const answerBtn = document.getElementById('answer-btn');

  const incomingCall = document.getElementById('incoming-call');
  const callerNumber = document.getElementById('caller-number');
  const modalAnswerBtn = document.getElementById('modal-answer-btn');
  const modalRejectBtn = document.getElementById('modal-reject-btn');

  const inCallFull = document.getElementById('in-call-fullscreen');
  const inCallNumber = document.getElementById('in-call-number');
  const endCallBtn = document.getElementById('end-call-btn');
  const callTimeDisplay = document.getElementById('call-time');
  const statusText = document.querySelector('#in-call-fullscreen .status-text');

  let phoneNumber = '';
  let autoAnswerTimer = null;
  let callTimer = null;
  let callStartTime = null;
  let callTimeInterval = null;

  let callCycleTimer = null;

  // Í∞ÑÎã® Î≤®Ïùå Ïû¨ÏÉù (Web Audio API)
  let audioCtx = null;
  function playBeep() {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    const oscillator = audioCtx.createOscillator();
    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // 440Hz (A4)
    oscillator.connect(audioCtx.destination);
    oscillator.start();
    setTimeout(() => oscillator.stop(), 500);
  }

  function updateCallBtn() {
    callBtn.disabled = phoneNumber.length < 1;
  }

  // ÌÇ§ ÏûÖÎ†• Ïù¥Î≤§Ìä∏
  keys.forEach(key => {
    key.addEventListener('click', () => {
      if (phoneNumber.length >= 20) return;
      phoneNumber += key.textContent;
      display.textContent = phoneNumber;
      updateCallBtn();
    });
  });

  // ÏßÄÏö∞Í∏∞
  clearBtn.addEventListener('click', () => {
    phoneNumber = phoneNumber.slice(0, -1);
    display.textContent = phoneNumber;
    updateCallBtn();
  });

  // ÌÇ§Ìå®Îìú Ï¥àÍ∏∞Ìôî
  function resetToKeypad() {
    phoneNumber = '';
    display.textContent = '';
    updateCallBtn();
    incomingCall.classList.remove('show');
    inCallFull.classList.remove('show');
    answerBtn.style.display = 'none';
  }

  // Ï†ÑÌôî Í±∏Í∏∞
  callBtn.addEventListener('click', () => {
    if (phoneNumber.length < 1) return;
    startCall(phoneNumber);
  });

  // Ï†ÑÌôî Î∞õÍ∏∞ Î≤ÑÌäº (ÏÉÅÎã® Î∞îÎ°ú Î∞õÍ∏∞)
  answerBtn.addEventListener('click', () => {
    answerCall();
  });

  // Î™®Îã¨ÏóêÏÑú Î∞õÍ∏∞ Î≤ÑÌäº
  modalAnswerBtn.addEventListener('click', () => {
    answerCall();
  });

  // Î™®Îã¨ÏóêÏÑú Í±∞Ï†à Î≤ÑÌäº
  modalRejectBtn.addEventListener('click', () => {
    rejectCall();
  });

  // ÌÜµÌôî Ï¢ÖÎ£å Î≤ÑÌäº
  endCallBtn.addEventListener('click', () => {
    endCall();
  });

  // ÌÜµÌôî ÏãúÏûë Ìï®Ïàò
  function startCall(number) {
  callBtn.disabled = true;
  clearBtn.disabled = true;
  answerBtn.style.display = 'none';

  inCallNumber.textContent = number;
  statusText.textContent = 'ÌÜµÌôî Ï§ë...';
  callTimeDisplay.textContent = '0Ï¥à';

  inCallFull.classList.add('show');
  callStartTime = Date.now();

  // ÌÜµÌôî ÏãúÍ∞Ñ ÌÉÄÏù¥Î®∏ ÏãúÏûë
  callTimeInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - callStartTime) / 1000);
    callTimeDisplay.textContent = `${elapsed}Ï¥à`;
  }, 1000);

  // üî¥ 10Ï¥à ÌõÑ ÏûêÎèô Ï¢ÖÎ£å
  callTimer = setTimeout(() => {
    endCall();
  }, 10000);
}


  // ÌÜµÌôî Ï¢ÖÎ£å Ìï®Ïàò
  function endCall() {
    clearInterval(callTimeInterval);
    clearTimeout(callTimer);

    const elapsedSec = Math.floor((Date.now() - callStartTime) / 1000);

    // ÏÉÅÌÉú ÌÖçÏä§Ìä∏Î•º 'ÌÜµÌôî Ï¢ÖÎ£å'Î°ú Î≥ÄÍ≤Ω
    statusText.textContent = 'ÌÜµÌôî Ï¢ÖÎ£å';

    // ÌÜµÌôî ÏãúÍ∞Ñ Ïú†ÏßÄ
    callTimeDisplay.textContent = `${elapsedSec}Ï¥à`;

    // ÌÜµÌôî Ï¢ÖÎ£å Î≤ÑÌäº Ïà®Í∏∞Í∏∞
    endCallBtn.style.display = 'none';

    // 3Ï¥à ÌõÑ Ï¥àÍ∏∞Ìôî Î∞è ÌÜµÌôî Ï¢ÖÎ£å Î≤ÑÌäº Ïû¨ÌëúÏãú
    setTimeout(() => {
      resetToKeypad();
      startCallCycle();
      endCallBtn.style.display = 'flex';
    }, 3000);
  }

  // Ï†ÑÌôî Î∞õÍ∏∞ Ìï®Ïàò
  function answerCall() {
    // Î™®Îã¨ Ïà®Í∏∞Í∏∞
    incomingCall.classList.remove('show');
    answerBtn.style.display = 'none';

    // ÌÜµÌôî ÏãúÏûë
    startCall(callerNumber.textContent);
  }

  // Ï†ÑÌôî Í±∞Ï†à Ìï®Ïàò
  function rejectCall() {
    clearTimeout(autoAnswerTimer);
    incomingCall.classList.remove('show');
    answerBtn.style.display = 'none';
    resetToKeypad();
    startCallCycle();
  }

  // ÏûêÎèô Ï†ÑÌôî ÏÇ¨Ïù¥ÌÅ¥ ÏãúÏûë
  function startCallCycle() {
    callCycleTimer = setTimeout(() => {
      const randomNumber = generateRandomNumber();
      callerNumber.textContent = randomNumber;
      incomingCall.classList.add('show');
      answerBtn.style.display = 'inline-block';

      // Î≤® Ïö∏Î¶º (5Ï¥àÍ∞Ñ)
      let count = 0;
      const beepInterval = setInterval(() => {
        playBeep();
        count++;
        if (count >= 5) clearInterval(beepInterval);
      }, 1000);

      // 5Ï¥à ÌõÑ ÏûêÎèô ÏàòÏã† (answer)
      autoAnswerTimer = setTimeout(() => {
        if (incomingCall.classList.contains('show')) {
          answerCall();
        }
      }, 5000);
    }, 1500);
  }

  // Î≤àÌò∏ ÏÉùÏÑ± Ìï®Ïàò (010-XXXX-XXXX)
  function generateRandomNumber() {
    const getNum = () => Math.floor(Math.random() * 10000).toString().padStart(4, '0');
    return `010-${getNum()}-${getNum()}`;
  }

  // Ï¥àÍ∏∞ ÏãúÏûë
  resetToKeypad();
  startCallCycle();
</script>

</body>
</html>
